{% extends 'base.html' %}
{% load static %}

{% block title %}
Profile
{% endblock %}
{% block styles %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}" />
{% endblock %}

{% block content %}
<div class="profile-container-container">
    <div class="profile-container">
        <div class="profile-header">
            <div class="profile-image">
                <img src="https://sh22-vologda-r19.gosweb.gosuslugi.ru/netcat_files/8/148/net_foto.jpg"
                    alt="Profile Image" />
            </div>
            <div class="profile-info">
                <h2>{{ nickname }}</h2>
                <p>
                    Участник с:<br><span>{{ date_joined }}</span>
                </p>
            </div>
            {% if user.id == user_id %}
            <div class="logout">
                <div class="indentation">
                    <a href="{% url 'logout' user.id %}"><button>Выйти</button></a>
                </div>
            </div>
            {% endif %}
        </div>
        <hr />
        <div class="profile-stats">
            <div class="stat">
                <h3>Выполнено заданий</h3>
                <p>5</p>
            </div>
            <div class="stat">
                <h3>Интересы</h3>
                <p>2</p>
            </div>
            <div class="stat">
                <h3>Друзья</h3>
                <p>20</p>
            </div>
        </div>
        <div class="profile-interests">
            <h2>Интересы:</h2>
            <div class="interests-list">
                <div class="interest-box-shadow">
                    <div class="interest-box-border">
                        <div class="interest-box">
                            <div class="image-container">
                                <img src="https://avatars.mds.yandex.net/i?id=743664af1475046ddf9fe5149eeee155_l-9065887-images-thumbs&n=13"
                                    alt="Technology" />
                            </div>
                            <div class="label">Технологии</div>
                        </div>
                    </div>
                </div>
                <div class="interest-box-shadow">
                    <div class="interest-box-border">
                        <div class="interest-box">
                            <div class="image-container">
                                <img src="https://avatars.mds.yandex.net/i?id=73aa7bee9641f1d37382e5813e3841bf_l-4575585-images-thumbs&n=13"
                                    alt="Creative" />
                            </div>
                            <div class="label">Искусство</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="events">
            <h2>Список выполненных заданий:</h2>
            <ul class="task-list">
                {% for completedTask in completedTasks %}
                <li class="task-item">
                    Задание {{completedTask.task.id}} - {{completedTask.task.description}} <span class="task-date"> <a href="javascript:void(0);" onclick="openModal()" style="color: aqua;">Подтверждено: {{completedTask.confirmed}}</a>
                        - {{completedTask.completed_when}}</span>
                </li>
                {% endfor %}
            </ul>
        </div>    
    </div>
</div>
<div class="modal-container" id="confirmation-modal">
    <div class="modal-content">
        <h3>Подтвердите выполнение задания</h3>
        <form method="POST" action="" enctype="multipart/form-data">
            {% csrf_token %}
            <label for="upload-image">Загрузите изображение подтверждения:</label>
            <input type="file" name="confirmation_image" id="upload-image" accept="image/png, image/mp4, image/jpeg" required />
            <label for="image-description">Добавьте описание:</label>
            <textarea name="image_description" id="image-description" placeholder="Напишите описание к загруженному изображению..." required></textarea>
            
            <div class="modal-buttons">
                <button type="submit">Подтвердить</button>
                <button type="button" class="modal-close">Отмена</button>
            </div>
        </form>
    </div>
</div>


<script>
document.addEventListener("DOMContentLoaded", function () {
    const modal = document.getElementById("confirmation-modal");
    const closeModalButtons = document.querySelectorAll(".modal-close");
    const taskLinks = document.querySelectorAll(".task-date a");

    // Открыть модальное окно
    taskLinks.forEach(link => {
        link.addEventListener("click", function (e) {
            e.preventDefault();
            modal.classList.add("active");
        });
    });

    // Закрыть модальное окно (по кнопке "Отмена")
    closeModalButtons.forEach(button => {
        button.addEventListener("click", function () {
            modal.classList.remove("active");
        });
    });

    // Закрыть модальное окно (по клику вне области окна)
    modal.addEventListener("click", function (e) {
        if (e.target === modal) {
            modal.classList.remove("active");
        }
    });

    // Закрыть модальное окно (по нажатию Esc)
    document.addEventListener("keydown", function (e) {
        if (e.key === "Escape" && modal.classList.contains("active")) {
            modal.classList.remove("active");
        }
    });
});


</script>

{% endblock %}